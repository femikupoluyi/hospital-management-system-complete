<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .login-container { display: flex; align-items: center; justify-content: center; min-height: 100vh; }
        .login-card { background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); padding: 40px; max-width: 400px; }
        .main-container { display: none; background: white; min-height: 100vh; }
        .sidebar { background: linear-gradient(180deg, #1e3c72 0%, #2a5298 100%); min-height: 100vh; color: white; padding: 20px 0; position: fixed; width: 250px; }
        .sidebar .nav-link { color: rgba(255,255,255,0.8); padding: 12px 20px; margin: 5px 15px; border-radius: 10px; }
        .sidebar .nav-link:hover, .sidebar .nav-link.active { background: rgba(255,255,255,0.2); color: white; }
        .content-area { margin-left: 250px; padding: 20px; }
        .module-card { background: white; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); padding: 30px; margin-bottom: 20px; }
        .stats-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 20px; margin-bottom: 20px; }
        .btn-primary-custom { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 10px; padding: 10px 25px; color: white; }
    </style>
</head>
<body>
    <!-- Login Section -->
    <div id="loginSection" class="login-container">
        <div class="login-card">
            <div class="text-center mb-4">
                <i class="bi bi-hospital" style="font-size: 4rem; color: #0066cc;"></i>
                <h2 class="mt-3">Hospital Management System</h2>
                <p class="text-muted">Secure Healthcare Platform</p>
            </div>
            <form id="loginForm">
                <div class="mb-3">
                    <label class="form-label">Username or Email</label>
                    <input type="text" class="form-control" id="username" value="admin" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-control" id="password" value="admin@HMS2024" required>
                </div>
                <button type="submit" class="btn btn-primary-custom w-100">
                    <i class="bi bi-lock"></i> Login
                </button>
            </form>
            <div class="mt-3 text-center">
                <small class="text-muted">Default: admin / admin@HMS2024</small>
            </div>
        </div>
    </div>
    
    <!-- Main Application -->
    <div id="mainApp" class="main-container">
        <nav class="sidebar">
            <div class="text-center mb-4">
                <i class="bi bi-hospital" style="font-size: 3rem;"></i>
                <h5 class="mt-2">HMS</h5>
            </div>
            <div class="user-info text-center mb-4">
                <i class="bi bi-person-circle" style="font-size: 2rem;"></i>
                <p class="mb-0" id="userFullName">User Name</p>
                <small id="userRole">Role</small>
            </div>
            <ul class="nav flex-column">
                <li class="nav-item"><a class="nav-link active" href="#" data-module="dashboard"><i class="bi bi-speedometer2"></i> Dashboard</a></li>
                <li class="nav-item"><a class="nav-link" href="#" data-module="medical-records"><i class="bi bi-clipboard-pulse"></i> Medical Records</a></li>
                <li class="nav-item"><a class="nav-link" href="#" data-module="billing"><i class="bi bi-currency-dollar"></i> Billing</a></li>
                <li class="nav-item"><a class="nav-link" href="#" data-module="inventory"><i class="bi bi-box-seam"></i> Inventory</a></li>
                <li class="nav-item"><a class="nav-link" href="#" data-module="staff"><i class="bi bi-people"></i> Staff</a></li>
                <li class="nav-item"><a class="nav-link" href="#" data-module="beds"><i class="bi bi-hospital"></i> Beds</a></li>
                <li class="nav-item"><a class="nav-link" href="#" data-module="patients"><i class="bi bi-person-badge"></i> Patients</a></li>
                <li class="nav-item mt-4"><a class="nav-link" href="#" id="logoutBtn"><i class="bi bi-box-arrow-right"></i> Logout</a></li>
            </ul>
        </nav>
        
        <div class="content-area">
            <!-- Dashboard -->
            <div id="dashboard-module" class="module-content">
                <h2><i class="bi bi-speedometer2"></i> Dashboard</h2>
                <div class="row mt-4">
                    <div class="col-md-3"><div class="stats-card"><h6>Total Patients</h6><h3 id="totalPatients">0</h3></div></div>
                    <div class="col-md-3"><div class="stats-card"><h6>Monthly Revenue</h6><h3 id="monthlyRevenue">â‚¦0</h3></div></div>
                    <div class="col-md-3"><div class="stats-card"><h6>Bed Occupancy</h6><h3 id="bedOccupancy">0%</h3></div></div>
                    <div class="col-md-3"><div class="stats-card"><h6>Staff on Duty</h6><h3 id="staffOnDuty">0</h3></div></div>
                </div>
            </div>
            
            <!-- Medical Records -->
            <div id="medical-records-module" class="module-content" style="display: none;">
                <h2><i class="bi bi-clipboard-pulse"></i> Medical Records</h2>
                <button class="btn btn-primary-custom" onclick="showNewRecordForm()"><i class="bi bi-plus"></i> New Record</button>
                <button class="btn btn-secondary ms-2" onclick="viewRecords()"><i class="bi bi-list"></i> View Records</button>
                <div id="recordsContent" class="mt-4"></div>
            </div>
            
            <!-- Billing -->
            <div id="billing-module" class="module-content" style="display: none;">
                <h2><i class="bi bi-currency-dollar"></i> Billing & Revenue</h2>
                <button class="btn btn-primary-custom" onclick="createInvoice()"><i class="bi bi-receipt"></i> Create Invoice</button>
                <button class="btn btn-secondary ms-2" onclick="viewInvoices()"><i class="bi bi-list"></i> View Invoices</button>
                <div id="billingContent" class="mt-4"></div>
            </div>
            
            <!-- Inventory -->
            <div id="inventory-module" class="module-content" style="display: none;">
                <h2><i class="bi bi-box-seam"></i> Inventory Management</h2>
                <button class="btn btn-primary-custom" onclick="addStockEntry()"><i class="bi bi-plus"></i> Stock Entry</button>
                <button class="btn btn-warning ms-2" onclick="checkLowStock()"><i class="bi bi-exclamation-triangle"></i> Low Stock Alert</button>
                <button class="btn btn-secondary ms-2" onclick="viewInventory()"><i class="bi bi-list"></i> View All</button>
                <div id="inventoryContent" class="mt-4"></div>
            </div>
            
            <!-- Staff -->
            <div id="staff-module" class="module-content" style="display: none;">
                <h2><i class="bi bi-people"></i> Staff Management</h2>
                <button class="btn btn-primary-custom" onclick="addSchedule()"><i class="bi bi-calendar-plus"></i> Add Schedule</button>
                <button class="btn btn-secondary ms-2" onclick="viewRoster()"><i class="bi bi-calendar-week"></i> View Roster</button>
                <div id="staffContent" class="mt-4"></div>
            </div>
            
            <!-- Beds -->
            <div id="beds-module" class="module-content" style="display: none;">
                <h2><i class="bi bi-hospital"></i> Bed Management</h2>
                <button class="btn btn-primary-custom" onclick="newAdmission()"><i class="bi bi-person-plus"></i> New Admission</button>
                <button class="btn btn-success ms-2" onclick="viewAvailableBeds()"><i class="bi bi-check-circle"></i> Available Beds</button>
                <div id="bedsContent" class="mt-4"></div>
            </div>
            
            <!-- Patients -->
            <div id="patients-module" class="module-content" style="display: none;">
                <h2><i class="bi bi-person-badge"></i> Patient Management</h2>
                <button class="btn btn-primary-custom" onclick="registerPatient()"><i class="bi bi-person-plus"></i> Register Patient</button>
                <button class="btn btn-secondary ms-2" onclick="viewPatients()"><i class="bi bi-list"></i> View Patients</button>
                <div id="patientsContent" class="mt-4"></div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let authToken = '';
        let currentUser = null;
        const API_BASE = 'http://localhost:5801/api';
        
        // Login
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username: document.getElementById('username').value,
                        password: document.getElementById('password').value
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    authToken = data.token;
                    currentUser = data.user;
                    showMainApp();
                    loadDashboard();
                } else {
                    alert('Login failed!');
                }
            } catch (error) {
                alert('Connection error!');
            }
        });
        
        // Show main app
        function showMainApp() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            if (currentUser) {
                document.getElementById('userFullName').textContent = currentUser.fullName || currentUser.username;
                document.getElementById('userRole').textContent = currentUser.role.toUpperCase();
            }
        }
        
        // Module navigation
        document.querySelectorAll('.sidebar .nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const module = e.currentTarget.dataset.module;
                if (module) {
                    document.querySelectorAll('.sidebar .nav-link').forEach(l => l.classList.remove('active'));
                    e.currentTarget.classList.add('active');
                    document.querySelectorAll('.module-content').forEach(m => m.style.display = 'none');
                    const moduleElement = document.getElementById(`${module}-module`);
                    if (moduleElement) {
                        moduleElement.style.display = 'block';
                        if (module === 'dashboard') loadDashboard();
                    }
                }
            });
        });
        
        // Logout
        document.getElementById('logoutBtn').addEventListener('click', (e) => {
            e.preventDefault();
            authToken = '';
            location.reload();
        });
        
        // Dashboard
        async function loadDashboard() {
            try {
                const response = await fetch(`${API_BASE}/analytics/dashboard`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('totalPatients').textContent = data.patients?.total_patients || 0;
                    document.getElementById('monthlyRevenue').textContent = 'â‚¦' + (data.revenue?.monthly_revenue || 0).toLocaleString();
                    document.getElementById('bedOccupancy').textContent = data.beds?.occupancy_rate || '0%';
                    document.getElementById('staffOnDuty').textContent = data.staff?.on_duty_today || 0;
                }
            } catch (error) {
                console.error('Dashboard error:', error);
            }
        }
        
        // Medical Records Functions
        function showNewRecordForm() {
            document.getElementById('recordsContent').innerHTML = `
                <div class="module-card">
                    <h5>New Medical Record</h5>
                    <form id="newRecordForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label>Patient ID</label>
                                <input type="text" class="form-control" id="patientId" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label>Record Type</label>
                                <select class="form-control" id="recordType">
                                    <option>Consultation</option>
                                    <option>Diagnosis</option>
                                    <option>Prescription</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label>Chief Complaint</label>
                            <textarea class="form-control" id="chiefComplaint" rows="2"></textarea>
                        </div>
                        <div class="mb-3">
                            <label>Diagnosis</label>
                            <textarea class="form-control" id="diagnosis" rows="2"></textarea>
                        </div>
                        <div class="mb-3">
                            <label>Treatment</label>
                            <textarea class="form-control" id="treatment" rows="2"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary-custom">Save Record</button>
                    </form>
                </div>
            `;
            
            document.getElementById('newRecordForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                try {
                    const response = await fetch(`${API_BASE}/medical-records`, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: JSON.stringify({
                            patientId: document.getElementById('patientId').value,
                            recordType: document.getElementById('recordType').value,
                            chiefComplaint: document.getElementById('chiefComplaint').value,
                            diagnosis: document.getElementById('diagnosis').value,
                            treatment: document.getElementById('treatment').value
                        })
                    });
                    
                    if (response.ok) {
                        alert('Medical record saved successfully!');
                        document.getElementById('recordsContent').innerHTML = '';
                    } else {
                        const error = await response.json();
                        alert('Error: ' + error.error);
                    }
                } catch (error) {
                    alert('Failed to save record');
                }
            });
        }
        
        function viewRecords() {
            document.getElementById('recordsContent').innerHTML = `
                <div class="module-card">
                    <h5>Search Medical Records</h5>
                    <input type="text" class="form-control" placeholder="Enter Patient ID" id="searchPatientId">
                    <button class="btn btn-primary-custom mt-2" onclick="searchRecords()">Search</button>
                    <div id="recordsList" class="mt-3"></div>
                </div>
            `;
        }
        
        async function searchRecords() {
            const patientId = document.getElementById('searchPatientId').value;
            if (!patientId) return;
            
            try {
                const response = await fetch(`${API_BASE}/medical-records/${patientId}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                if (response.ok) {
                    const records = await response.json();
                    let html = '<table class="table"><thead><tr><th>Date</th><th>Type</th><th>Diagnosis</th></tr></thead><tbody>';
                    records.forEach(r => {
                        html += `<tr><td>${new Date(r.created_at).toLocaleDateString()}</td><td>${r.record_type}</td><td>${r.diagnosis || '-'}</td></tr>`;
                    });
                    html += '</tbody></table>';
                    document.getElementById('recordsList').innerHTML = html;
                }
            } catch (error) {
                alert('Failed to fetch records');
            }
        }
        
        // Billing Functions
        function createInvoice() {
            document.getElementById('billingContent').innerHTML = `
                <div class="module-card">
                    <h5>Create Invoice</h5>
                    <form id="invoiceForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label>Patient ID</label>
                                <input type="text" class="form-control" id="invoicePatientId" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label>Payment Method</label>
                                <select class="form-control" id="paymentMethod">
                                    <option>Cash</option>
                                    <option>Insurance</option>
                                    <option>Card</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label>Total Amount (â‚¦)</label>
                            <input type="number" class="form-control" id="totalAmount" required>
                        </div>
                        <button type="submit" class="btn btn-primary-custom">Generate Invoice</button>
                    </form>
                </div>
            `;
            
            document.getElementById('invoiceForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                try {
                    const response = await fetch(`${API_BASE}/billing/invoices`, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: JSON.stringify({
                            patientId: document.getElementById('invoicePatientId').value,
                            items: [{ description: 'Medical Services', amount: parseFloat(document.getElementById('totalAmount').value) }],
                            totalAmount: parseFloat(document.getElementById('totalAmount').value),
                            paymentMethod: document.getElementById('paymentMethod').value
                        })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        alert(`Invoice created: ${data.invoice.invoice_number}`);
                        document.getElementById('billingContent').innerHTML = '';
                    }
                } catch (error) {
                    alert('Failed to create invoice');
                }
            });
        }
        
        async function viewInvoices() {
            try {
                const response = await fetch(`${API_BASE}/billing/invoices`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                if (response.ok) {
                    const invoices = await response.json();
                    let html = '<div class="module-card"><h5>Recent Invoices</h5><table class="table"><thead><tr><th>Invoice#</th><th>Patient</th><th>Amount</th><th>Status</th></tr></thead><tbody>';
                    invoices.forEach(inv => {
                        html += `<tr><td>${inv.invoice_number}</td><td>${inv.patient_id}</td><td>â‚¦${inv.total_amount}</td><td>${inv.status}</td></tr>`;
                    });
                    html += '</tbody></table></div>';
                    document.getElementById('billingContent').innerHTML = html;
                }
            } catch (error) {
                alert('Failed to fetch invoices');
            }
        }
        
        // Inventory Functions
        function addStockEntry() {
            document.getElementById('inventoryContent').innerHTML = `
                <div class="module-card">
                    <h5>Add Stock Entry</h5>
                    <form id="stockForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label>Item Name</label>
                                <input type="text" class="form-control" id="itemName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label>Category</label>
                                <select class="form-control" id="category">
                                    <option>Medication</option>
                                    <option>Equipment</option>
                                    <option>Consumable</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label>Quantity</label>
                                <input type="number" class="form-control" id="quantity" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label>Min Stock</label>
                                <input type="number" class="form-control" id="minimumStock" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label>Unit Price</label>
                                <input type="number" class="form-control" id="unitPrice" step="0.01">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary-custom">Add to Inventory</button>
                    </form>
                </div>
            `;
            
            document.getElementById('stockForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                try {
                    const response = await fetch(`${API_BASE}/inventory/stock`, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: JSON.stringify({
                            itemName: document.getElementById('itemName').value,
                            category: document.getElementById('category').value.toLowerCase(),
                            quantity: parseInt(document.getElementById('quantity').value),
                            minimumStock: parseInt(document.getElementById('minimumStock').value),
                            unitPrice: parseFloat(document.getElementById('unitPrice').value) || 0
                        })
                    });
                    
                    if (response.ok) {
                        alert('Stock added successfully!');
                        document.getElementById('inventoryContent').innerHTML = '';
                    }
                } catch (error) {
                    alert('Failed to add stock');
                }
            });
        }
        
        async function checkLowStock() {
            try {
                const response = await fetch(`${API_BASE}/inventory/low-stock`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                if (response.ok) {
                    const items = await response.json();
                    if (items.length === 0) {
                        document.getElementById('inventoryContent').innerHTML = '<div class="alert alert-success">All items are well stocked!</div>';
                    } else {
                        let html = '<div class="module-card"><h5>Low Stock Alert</h5><table class="table"><thead><tr><th>Item</th><th>Current</th><th>Minimum</th></tr></thead><tbody>';
                        items.forEach(item => {
                            html += `<tr><td>${item.item_name}</td><td>${item.quantity}</td><td>${item.minimum_stock}</td></tr>`;
                        });
                        html += '</tbody></table></div>';
                        document.getElementById('inventoryContent').innerHTML = html;
                    }
                }
            } catch (error) {
                alert('Failed to check stock');
            }
        }
        
        async function viewInventory() {
            try {
                const response = await fetch(`${API_BASE}/inventory`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                if (response.ok) {
                    const items = await response.json();
                    let html = '<div class="module-card"><h5>Inventory</h5><table class="table"><thead><tr><th>Item</th><th>Category</th><th>Quantity</th><th>Min Stock</th></tr></thead><tbody>';
                    items.forEach(item => {
                        html += `<tr><td>${item.item_name}</td><td>${item.category}</td><td>${item.quantity}</td><td>${item.minimum_stock}</td></tr>`;
                    });
                    html += '</tbody></table></div>';
                    document.getElementById('inventoryContent').innerHTML = html;
                }
            } catch (error) {
                alert('Failed to fetch inventory');
            }
        }
        
        // Staff Functions
        function addSchedule() {
            document.getElementById('staffContent').innerHTML = `
                <div class="module-card">
                    <h5>Add Staff Schedule</h5>
                    <form id="scheduleForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label>Staff ID</label>
                                <input type="number" class="form-control" id="staffId" value="1" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label>Department</label>
                                <select class="form-control" id="department">
                                    <option>Emergency</option>
                                    <option>General</option>
                                    <option>ICU</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label>Date</label>
                                <input type="date" class="form-control" id="shiftDate" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label>Start Time</label>
                                <input type="time" class="form-control" id="shiftStart" value="08:00" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label>End Time</label>
                                <input type="time" class="form-control" id="shiftEnd" value="16:00" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary-custom">Save Schedule</button>
                    </form>
                </div>
            `;
            
            document.getElementById('shiftDate').value = new Date().toISOString().split('T')[0];
            
            document.getElementById('scheduleForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                try {
                    const response = await fetch(`${API_BASE}/staff/schedule`, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: JSON.stringify({
                            staffId: document.getElementById('staffId').value,
                            department: document.getElementById('department').value,
                            shiftDate: document.getElementById('shiftDate').value,
                            shiftStart: document.getElementById('shiftStart').value,
                            shiftEnd: document.getElementById('shiftEnd').value
                        })
                    });
                    
                    if (response.ok) {
                        alert('Schedule saved!');
                        document.getElementById('staffContent').innerHTML = '';
                    }
                } catch (error) {
                    alert('Failed to save schedule');
                }
            });
        }
        
        function viewRoster() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('staffContent').innerHTML = `
                <div class="module-card">
                    <h5>Staff Roster</h5>
                    <input type="date" class="form-control" id="rosterDate" value="${today}">
                    <button class="btn btn-primary-custom mt-2" onclick="loadRoster()">Load Roster</button>
                    <div id="rosterList" class="mt-3"></div>
                </div>
            `;
        }
        
        async function loadRoster() {
            const date = document.getElementById('rosterDate').value;
            try {
                const response = await fetch(`${API_BASE}/staff/roster/${date}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                if (response.ok) {
                    const roster = await response.json();
                    if (roster.length === 0) {
                        document.getElementById('rosterList').innerHTML = '<p>No schedules for this date</p>';
                    } else {
                        let html = '<table class="table"><thead><tr><th>Staff</th><th>Department</th><th>Shift</th></tr></thead><tbody>';
                        roster.forEach(r => {
                            html += `<tr><td>${r.full_name || 'Staff ' + r.staff_id}</td><td>${r.department}</td><td>${r.shift_start} - ${r.shift_end}</td></tr>`;
                        });
                        html += '</tbody></table>';
                        document.getElementById('rosterList').innerHTML = html;
                    }
                }
            } catch (error) {
                alert('Failed to load roster');
            }
        }
        
        // Bed Functions
        function newAdmission() {
            document.getElementById('bedsContent').innerHTML = `
                <div class="module-card">
                    <h5>New Admission</h5>
                    <form id="admissionForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label>Patient ID</label>
                                <input type="text" class="form-control" id="admPatientId" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label>Ward</label>
                                <select class="form-control" id="wardId">
                                    <option value="1">General Ward</option>
                                    <option value="2">ICU</option>
                                    <option value="3">Pediatric</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label>Bed Number</label>
                            <input type="text" class="form-control" id="bedNumber" placeholder="e.g. GW-01" required>
                        </div>
                        <button type="submit" class="btn btn-primary-custom">Admit Patient</button>
                    </form>
                </div>
            `;
            
            document.getElementById('admissionForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                try {
                    const response = await fetch(`${API_BASE}/beds/admission`, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: JSON.stringify({
                            patientId: document.getElementById('admPatientId').value,
                            wardId: document.getElementById('wardId').value,
                            bedNumber: document.getElementById('bedNumber').value,
                            admissionReason: 'Medical treatment'
                        })
                    });
                    
                    if (response.ok) {
                        alert('Patient admitted successfully!');
                        document.getElementById('bedsContent').innerHTML = '';
                    } else {
                        const error = await response.json();
                        alert('Error: ' + error.error);
                    }
                } catch (error) {
                    alert('Failed to admit patient');
                }
            });
        }
        
        async function viewAvailableBeds() {
            try {
                const response = await fetch(`${API_BASE}/beds/available`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                if (response.ok) {
                    const beds = await response.json();
                    if (beds.length === 0) {
                        document.getElementById('bedsContent').innerHTML = '<div class="alert alert-warning">No beds available</div>';
                    } else {
                        let html = '<div class="module-card"><h5>Available Beds</h5><table class="table"><thead><tr><th>Ward</th><th>Bed Number</th><th>Status</th></tr></thead><tbody>';
                        beds.forEach(bed => {
                            html += `<tr><td>${bed.ward_name}</td><td>${bed.bed_number}</td><td><span class="badge bg-success">Available</span></td></tr>`;
                        });
                        html += '</tbody></table></div>';
                        document.getElementById('bedsContent').innerHTML = html;
                    }
                }
            } catch (error) {
                alert('Failed to fetch beds');
            }
        }
        
        // Patient Functions
        function registerPatient() {
            document.getElementById('patientsContent').innerHTML = `
                <div class="module-card">
                    <h5>Register New Patient</h5>
                    <form id="patientForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label>First Name</label>
                                <input type="text" class="form-control" id="firstName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label>Last Name</label>
                                <input type="text" class="form-control" id="lastName" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label>Date of Birth</label>
                                <input type="date" class="form-control" id="dateOfBirth">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label>Gender</label>
                                <select class="form-control" id="gender">
                                    <option>Male</option>
                                    <option>Female</option>
                                    <option>Other</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label>Phone</label>
                                <input type="tel" class="form-control" id="phone">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label>Email</label>
                            <input type="email" class="form-control" id="email">
                        </div>
                        <button type="submit" class="btn btn-primary-custom">Register Patient</button>
                    </form>
                </div>
            `;
            
            document.getElementById('patientForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                try {
                    const response = await fetch(`${API_BASE}/patients`, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: JSON.stringify({
                            firstName: document.getElementById('firstName').value,
                            lastName: document.getElementById('lastName').value,
                            dateOfBirth: document.getElementById('dateOfBirth').value,
                            gender: document.getElementById('gender').value,
                            phone: document.getElementById('phone').value,
                            email: document.getElementById('email').value
                        })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        alert(`Patient registered! ID: ${data.patient.patient_id}`);
                        document.getElementById('patientsContent').innerHTML = '';
                    }
                } catch (error) {
                    alert('Failed to register patient');
                }
            });
        }
        
        async function viewPatients() {
            try {
                const response = await fetch(`${API_BASE}/patients`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                if (response.ok) {
                    const patients = await response.json();
                    let html = '<div class="module-card"><h5>Registered Patients</h5><table class="table"><thead><tr><th>Patient ID</th><th>Name</th><th>Gender</th><th>Phone</th></tr></thead><tbody>';
                    patients.forEach(p => {
                        html += `<tr><td>${p.patient_id}</td><td>${p.first_name} ${p.last_name}</td><td>${p.gender}</td><td>${p.phone || '-'}</td></tr>`;
                    });
                    html += '</tbody></table></div>';
                    document.getElementById('patientsContent').innerHTML = html;
                }
            } catch (error) {
                alert('Failed to fetch patients');
            }
        }
    </script>
</body>
</html>
