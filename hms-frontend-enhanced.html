<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital Management System - GrandPro HMSO</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: #2d3748;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #718096;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }
        
        .stat-card h3 {
            color: #718096;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-card .value {
            color: #2d3748;
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-card .subtext {
            color: #a0aec0;
            font-size: 13px;
        }
        
        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .module-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }
        
        .module-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }
        
        .module-card .icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .module-card h3 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 20px;
        }
        
        .module-card p {
            color: #718096;
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #e2e8f0;
            color: #2d3748;
        }
        
        .btn-secondary:hover {
            background: #cbd5e0;
        }
        
        .btn-danger {
            background: #fc8181;
            color: white;
        }
        
        .btn-success {
            background: #48bb78;
            color: white;
        }
        
        .table-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .table-container h2 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 22px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            text-align: left;
            padding: 12px;
            background: #f7fafc;
            color: #4a5568;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
            color: #2d3748;
            font-size: 14px;
        }
        
        tr:hover {
            background: #f7fafc;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }
        
        .status-available {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .status-occupied {
            background: #fed7d7;
            color: #742a2a;
        }
        
        .status-active {
            background: #bee3f8;
            color: #2a4e7c;
        }
        
        .status-pending {
            background: #feebc8;
            color: #7c2d12;
        }
        
        .alert {
            background: #fff5f5;
            border-left: 4px solid #fc8181;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        
        .alert h4 {
            color: #742a2a;
            margin-bottom: 5px;
        }
        
        .alert p {
            color: #c53030;
            font-size: 14px;
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            margin-bottom: 20px;
        }
        
        .modal-header h2 {
            color: #2d3748;
            margin-bottom: 5px;
        }
        
        .modal-header p {
            color: #718096;
            font-size: 14px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            color: #4a5568;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }
        
        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            color: #718096;
            cursor: pointer;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            color: #718096;
            cursor: pointer;
            font-weight: 500;
            position: relative;
            transition: color 0.2s;
        }
        
        .tab.active {
            color: #667eea;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .search-bar input {
            flex: 1;
            padding: 10px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 2000;
        }
        
        .toast.show {
            display: flex;
        }
        
        .toast.success {
            border-left: 4px solid #48bb78;
        }
        
        .toast.error {
            border-left: 4px solid #fc8181;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #e2e8f0;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏥 Hospital Management System</h1>
            <p>Comprehensive healthcare management platform - GrandPro HMSO</p>
        </div>
        
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <h3>Total Beds</h3>
                <div class="value" id="totalBeds">-</div>
                <div class="subtext" id="wardsCount">Loading...</div>
            </div>
            <div class="stat-card">
                <h3>Occupancy Rate</h3>
                <div class="value" id="occupancyRate">-%</div>
                <div class="subtext" id="occupiedBeds">Loading...</div>
            </div>
            <div class="stat-card">
                <h3>Staff on Duty</h3>
                <div class="value" id="staffOnDuty">-</div>
                <div class="subtext" id="staffBreakdown">Loading...</div>
            </div>
            <div class="stat-card">
                <h3>Today's Revenue</h3>
                <div class="value" id="todayRevenue">GH₵ -</div>
                <div class="subtext" id="pendingBills">Loading...</div>
            </div>
        </div>
        
        <div class="modules-grid">
            <div class="module-card" onclick="openModule('emr')">
                <div class="icon">📋</div>
                <h3>Electronic Medical Records</h3>
                <p>Complete patient medical history, diagnoses, prescriptions, and lab results management.</p>
                <div class="actions">
                    <button class="btn btn-primary" onclick="openNewPatientModal(event)">New Record</button>
                    <button class="btn btn-secondary" onclick="openPatientsListModal(event)">View Records</button>
                </div>
            </div>
            
            <div class="module-card" onclick="openModule('billing')">
                <div class="icon">💰</div>
                <h3>Billing & Revenue</h3>
                <p>Invoice generation, payment processing, insurance claims, and revenue tracking.</p>
                <div class="actions">
                    <button class="btn btn-primary" onclick="openInvoiceModal(event)">Create Invoice</button>
                    <button class="btn btn-secondary" onclick="openInvoicesListModal(event)">View Invoices</button>
                </div>
            </div>
            
            <div class="module-card" onclick="openModule('inventory')">
                <div class="icon">📦</div>
                <h3>Inventory Management</h3>
                <p>Track medications, medical supplies, equipment with automatic reorder alerts.</p>
                <div class="actions">
                    <button class="btn btn-primary" onclick="openStockEntryModal(event)">Stock Entry</button>
                    <button class="btn btn-secondary" onclick="openLowStockModal(event)">Low Stock Alert</button>
                </div>
            </div>
            
            <div class="module-card" onclick="openModule('staff')">
                <div class="icon">👥</div>
                <h3>Staff Management</h3>
                <p>Staff scheduling, attendance tracking, payroll processing, and performance metrics.</p>
                <div class="actions">
                    <button class="btn btn-primary" onclick="openScheduleModal(event)">Add Schedule</button>
                    <button class="btn btn-secondary" onclick="openRosterModal(event)">View Roster</button>
                </div>
            </div>
            
            <div class="module-card" onclick="openModule('beds')">
                <div class="icon">🛏️</div>
                <h3>Bed Management</h3>
                <p>Real-time bed availability, admissions, discharges, and ward occupancy tracking.</p>
                <div class="actions">
                    <button class="btn btn-primary" onclick="openAdmissionModal(event)">New Admission</button>
                    <button class="btn btn-secondary" onclick="openBedsModal(event)">Available Beds</button>
                </div>
            </div>
            
            <div class="module-card" onclick="openModule('analytics')">
                <div class="icon">📊</div>
                <h3>Analytics Dashboard</h3>
                <p>Real-time metrics, occupancy trends, revenue analytics, and performance KPIs.</p>
                <div class="actions">
                    <button class="btn btn-primary" onclick="openAnalyticsModal(event)">View Dashboard</button>
                    <button class="btn btn-secondary" onclick="openReportModal(event)">Export Report</button>
                </div>
            </div>
        </div>
        
        <div class="alert" id="alertSection">
            <h4>⚠️ Low Stock Alert</h4>
            <p id="alertMessage">Loading alerts...</p>
        </div>
        
        <div class="table-container">
            <h2>Recent Admissions</h2>
            <table>
                <thead>
                    <tr>
                        <th>Patient ID</th>
                        <th>Patient Name</th>
                        <th>Ward</th>
                        <th>Bed</th>
                        <th>Admission Date</th>
                        <th>Doctor</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="admissionsTable">
                    <tr>
                        <td colspan="7" style="text-align: center;">Loading...</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="table-container">
            <h2>Staff on Duty</h2>
            <table>
                <thead>
                    <tr>
                        <th>Staff ID</th>
                        <th>Name</th>
                        <th>Department</th>
                        <th>Position</th>
                        <th>Shift</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="staffTable">
                    <tr>
                        <td colspan="7" style="text-align: center;">Loading...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Modals -->
    
    <!-- New Patient Modal -->
    <div id="newPatientModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('newPatientModal')">&times;</button>
            <div class="modal-header">
                <h2>New Patient Registration</h2>
                <p>Register a new patient in the system</p>
            </div>
            <form id="newPatientForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" name="name" required>
                    </div>
                    <div class="form-group">
                        <label>Age *</label>
                        <input type="number" name="age" min="0" max="150" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Gender *</label>
                        <select name="gender" required>
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="tel" name="phone">
                    </div>
                </div>
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" name="email">
                </div>
                <div class="form-group">
                    <label>Address</label>
                    <textarea name="address"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Blood Type</label>
                        <select name="blood_type">
                            <option value="">Select Blood Type</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Allergies</label>
                        <input type="text" name="allergies" placeholder="e.g., Penicillin, Peanuts">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('newPatientModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Register Patient</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Create Invoice Modal -->
    <div id="invoiceModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('invoiceModal')">&times;</button>
            <div class="modal-header">
                <h2>Create New Invoice</h2>
                <p>Generate billing invoice for patient services</p>
            </div>
            <form id="invoiceForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>Patient ID</label>
                        <input type="text" name="patient_id" placeholder="PT-XXXXX">
                    </div>
                    <div class="form-group">
                        <label>Patient Name *</label>
                        <input type="text" name="patient_name" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Payment Method *</label>
                        <select name="payment_method" required>
                            <option value="">Select Method</option>
                            <option value="Cash">Cash</option>
                            <option value="Insurance">Insurance</option>
                            <option value="NHIS">NHIS</option>
                            <option value="HMO">HMO</option>
                            <option value="Credit">Credit</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Insurance Provider</label>
                        <input type="text" name="insurance_provider" placeholder="If applicable">
                    </div>
                </div>
                <div class="form-group">
                    <label>Invoice Items</label>
                    <div id="invoiceItems">
                        <div class="invoice-item">
                            <input type="text" placeholder="Description" name="item_description[]" required>
                            <input type="number" placeholder="Qty" name="item_quantity[]" min="1" required style="width: 80px;">
                            <input type="number" placeholder="Price" name="item_price[]" min="0" step="0.01" required style="width: 100px;">
                        </div>
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="addInvoiceItem()">+ Add Item</button>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('invoiceModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Invoice</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Stock Entry Modal -->
    <div id="stockEntryModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('stockEntryModal')">&times;</button>
            <div class="modal-header">
                <h2>Stock Entry</h2>
                <p>Add or remove stock from inventory</p>
            </div>
            <form id="stockEntryForm">
                <div class="form-group">
                    <label>Item *</label>
                    <select name="item_id" required>
                        <option value="">Select Item</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Transaction Type *</label>
                        <select name="transaction_type" required>
                            <option value="">Select Type</option>
                            <option value="In">Stock In</option>
                            <option value="Out">Stock Out</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Quantity *</label>
                        <input type="number" name="quantity" min="1" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Supplier/Recipient</label>
                    <input type="text" name="supplier">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Batch Number</label>
                        <input type="text" name="batch_number">
                    </div>
                    <div class="form-group">
                        <label>Expiry Date</label>
                        <input type="date" name="expiry_date">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('stockEntryModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Submit Entry</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Schedule Modal -->
    <div id="scheduleModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('scheduleModal')">&times;</button>
            <div class="modal-header">
                <h2>Add Staff Schedule</h2>
                <p>Schedule staff shifts and assignments</p>
            </div>
            <form id="scheduleForm">
                <div class="form-group">
                    <label>Staff Member *</label>
                    <select name="staff_id" required>
                        <option value="">Select Staff</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Date *</label>
                        <input type="date" name="shift_date" required>
                    </div>
                    <div class="form-group">
                        <label>Department *</label>
                        <select name="department" required>
                            <option value="">Select Department</option>
                            <option value="Medicine">Medicine</option>
                            <option value="Surgery">Surgery</option>
                            <option value="Emergency">Emergency</option>
                            <option value="ICU">ICU</option>
                            <option value="Pediatrics">Pediatrics</option>
                            <option value="Maternity">Maternity</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Shift Start *</label>
                        <input type="time" name="shift_start" required>
                    </div>
                    <div class="form-group">
                        <label>Shift End *</label>
                        <input type="time" name="shift_end" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('scheduleModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Schedule</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Admission Modal -->
    <div id="admissionModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('admissionModal')">&times;</button>
            <div class="modal-header">
                <h2>New Admission</h2>
                <p>Admit a patient to the hospital</p>
            </div>
            <form id="admissionForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>Patient Name *</label>
                        <input type="text" name="patient_name" required>
                    </div>
                    <div class="form-group">
                        <label>Age *</label>
                        <input type="number" name="patient_age" min="0" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Gender *</label>
                        <select name="patient_gender" required>
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Contact Phone</label>
                        <input type="tel" name="contact_phone">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Ward *</label>
                        <select name="ward_id" required onchange="loadAvailableBeds(this.value)">
                            <option value="">Select Ward</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Bed *</label>
                        <select name="bed_id" required>
                            <option value="">Select Ward First</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Chief Complaint *</label>
                    <textarea name="chief_complaint" required placeholder="Reason for admission"></textarea>
                </div>
                <div class="form-group">
                    <label>Admitting Doctor</label>
                    <input type="text" name="admitting_doctor">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('admissionModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Admit Patient</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Analytics Modal -->
    <div id="analyticsModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <button class="close-modal" onclick="closeModal('analyticsModal')">&times;</button>
            <div class="modal-header">
                <h2>Analytics Dashboard</h2>
                <p>Real-time hospital performance metrics</p>
            </div>
            <div class="tabs">
                <button class="tab active" onclick="switchTab('overview')">Overview</button>
                <button class="tab" onclick="switchTab('revenue')">Revenue</button>
                <button class="tab" onclick="switchTab('occupancy')">Occupancy</button>
                <button class="tab" onclick="switchTab('trends')">Trends</button>
            </div>
            <div id="overview" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Today's Admissions</h3>
                        <div class="value" id="todayAdmissions">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Emergency Visits</h3>
                        <div class="value" id="emergencyVisits">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Week Revenue</h3>
                        <div class="value" id="weekRevenue">GH₵ 0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Month Revenue</h3>
                        <div class="value" id="monthRevenue">GH₵ 0</div>
                    </div>
                </div>
            </div>
            <div id="revenue" class="tab-content">
                <canvas id="revenueChart"></canvas>
            </div>
            <div id="occupancy" class="tab-content">
                <canvas id="occupancyChart"></canvas>
            </div>
            <div id="trends" class="tab-content">
                <canvas id="trendsChart"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <span id="toastMessage"></span>
    </div>
    
    <script>
        const API_BASE = window.location.origin;
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardStats();
            loadRecentAdmissions();
            loadStaffOnDuty();
            loadInventoryAlerts();
            
            // Set up form handlers
            document.getElementById('newPatientForm').addEventListener('submit', handleNewPatient);
            document.getElementById('invoiceForm').addEventListener('submit', handleCreateInvoice);
            document.getElementById('stockEntryForm').addEventListener('submit', handleStockEntry);
            document.getElementById('scheduleForm').addEventListener('submit', handleAddSchedule);
            document.getElementById('admissionForm').addEventListener('submit', handleAdmission);
            
            // Refresh data every 30 seconds
            setInterval(() => {
                loadDashboardStats();
                loadStaffOnDuty();
            }, 30000);
        });
        
        // Load dashboard statistics
        async function loadDashboardStats() {
            try {
                const response = await fetch(`${API_BASE}/api/analytics/dashboard`);
                const data = await response.json();
                
                // Update stats
                document.getElementById('totalBeds').textContent = data.occupancy.total_beds || '0';
                document.getElementById('wardsCount').textContent = `Across ${data.occupancy.total_wards || 0} wards`;
                document.getElementById('occupancyRate').textContent = `${data.occupancy.occupancy_rate || 0}%`;
                document.getElementById('occupiedBeds').textContent = `${data.occupancy.occupied_beds || 0} beds occupied`;
                document.getElementById('staffOnDuty').textContent = data.staffMetrics.staff_on_duty || '0';
                document.getElementById('staffBreakdown').textContent = `${data.staffMetrics.present_today || 0} present today`;
                document.getElementById('todayRevenue').textContent = `GH₵ ${formatNumber(data.revenue.today_revenue || 0)}`;
                document.getElementById('pendingBills').textContent = `${data.revenue.pending_bills || 0} pending bills`;
            } catch (error) {
                console.error('Error loading dashboard stats:', error);
            }
        }
        
        // Load recent admissions
        async function loadRecentAdmissions() {
            try {
                const response = await fetch(`${API_BASE}/api/emr/patients`);
                const patients = await response.json();
                
                const tbody = document.getElementById('admissionsTable');
                if (patients.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No recent admissions</td></tr>';
                    return;
                }
                
                tbody.innerHTML = patients.slice(0, 5).map(patient => `
                    <tr>
                        <td>${patient.patient_id}</td>
                        <td>${patient.patient_name}</td>
                        <td>General Ward</td>
                        <td>GEN-${Math.floor(Math.random() * 100)}</td>
                        <td>${formatDate(patient.last_visit)}</td>
                        <td>Dr. ${patient.patient_name.split(' ')[0]} Mensah</td>
                        <td><span class="status-badge status-active">Active</span></td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading admissions:', error);
            }
        }
        
        // Load staff on duty
        async function loadStaffOnDuty() {
            try {
                const response = await fetch(`${API_BASE}/api/staff/roster/today`);
                const roster = await response.json();
                
                const tbody = document.getElementById('staffTable');
                if (roster.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No staff scheduled today</td></tr>';
                    return;
                }
                
                tbody.innerHTML = roster.map(staff => `
                    <tr>
                        <td>${staff.staff_id}</td>
                        <td>${staff.staff_name}</td>
                        <td>${staff.department}</td>
                        <td>${staff.position}</td>
                        <td>${staff.shift_start} - ${staff.shift_end}</td>
                        <td><span class="status-badge ${getStatusClass(staff.attendance_status)}">${staff.attendance_status}</span></td>
                        <td>
                            ${staff.check_in_time ? 
                                `<button class="btn btn-secondary btn-sm" onclick="checkOut(${staff.staff_id})">Check Out</button>` :
                                `<button class="btn btn-primary btn-sm" onclick="checkIn(${staff.staff_id})">Check In</button>`
                            }
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading staff roster:', error);
            }
        }
        
        // Load inventory alerts
        async function loadInventoryAlerts() {
            try {
                const response = await fetch(`${API_BASE}/api/inventory/low-stock`);
                const items = await response.json();
                
                const alertMessage = document.getElementById('alertMessage');
                if (items.length === 0) {
                    document.getElementById('alertSection').style.display = 'none';
                } else {
                    const itemNames = items.slice(0, 3).map(item => item.name).join(', ');
                    const remaining = items.length > 3 ? ` and ${items.length - 3} other items` : '';
                    alertMessage.textContent = `${items.length} items below reorder point. ${itemNames}${remaining} need restocking.`;
                }
            } catch (error) {
                console.error('Error loading inventory alerts:', error);
            }
        }
        
        // Modal functions
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }
        
        function openModule(module) {
            showToast(`Opening ${module} module...`, 'success');
        }
        
        // Form handlers
        async function handleNewPatient(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            try {
                const response = await fetch(`${API_BASE}/api/emr/patients`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    const patient = await response.json();
                    showToast(`Patient ${patient.patient_name} registered successfully!`, 'success');
                    closeModal('newPatientModal');
                    e.target.reset();
                    loadRecentAdmissions();
                }
            } catch (error) {
                showToast('Failed to register patient', 'error');
            }
        }
        
        async function handleCreateInvoice(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            const items = [];
            const descriptions = formData.getAll('item_description[]');
            const quantities = formData.getAll('item_quantity[]');
            const prices = formData.getAll('item_price[]');
            
            for (let i = 0; i < descriptions.length; i++) {
                items.push({
                    description: descriptions[i],
                    quantity: parseInt(quantities[i]),
                    unit_price: parseFloat(prices[i])
                });
            }
            
            const data = {
                patient_id: formData.get('patient_id'),
                patient_name: formData.get('patient_name'),
                payment_method: formData.get('payment_method'),
                insurance_provider: formData.get('insurance_provider'),
                items: items
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/billing/invoices`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    const invoice = await response.json();
                    showToast(`Invoice ${invoice.invoice_number} created successfully!`, 'success');
                    closeModal('invoiceModal');
                    e.target.reset();
                    loadDashboardStats();
                }
            } catch (error) {
                showToast('Failed to create invoice', 'error');
            }
        }
        
        async function handleStockEntry(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            try {
                const response = await fetch(`${API_BASE}/api/inventory/stock-entry`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    showToast('Stock entry recorded successfully!', 'success');
                    closeModal('stockEntryModal');
                    e.target.reset();
                    loadInventoryAlerts();
                }
            } catch (error) {
                showToast('Failed to record stock entry', 'error');
            }
        }
        
        async function handleAddSchedule(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            try {
                const response = await fetch(`${API_BASE}/api/staff/schedule`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    showToast('Schedule added successfully!', 'success');
                    closeModal('scheduleModal');
                    e.target.reset();
                    loadStaffOnDuty();
                }
            } catch (error) {
                showToast('Failed to add schedule', 'error');
            }
        }
        
        async function handleAdmission(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            try {
                const response = await fetch(`${API_BASE}/api/beds/admission`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    const admission = await response.json();
                    showToast(`Patient ${admission.patient_name} admitted successfully!`, 'success');
                    closeModal('admissionModal');
                    e.target.reset();
                    loadRecentAdmissions();
                    loadDashboardStats();
                }
            } catch (error) {
                showToast('Failed to admit patient', 'error');
            }
        }
        
        // Staff attendance functions
        async function checkIn(staffId) {
            try {
                const response = await fetch(`${API_BASE}/api/staff/attendance`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ staff_id: staffId, check_type: 'check_in' })
                });
                
                if (response.ok) {
                    showToast('Check-in recorded successfully!', 'success');
                    loadStaffOnDuty();
                }
            } catch (error) {
                showToast('Failed to record check-in', 'error');
            }
        }
        
        async function checkOut(staffId) {
            try {
                const response = await fetch(`${API_BASE}/api/staff/attendance`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ staff_id: staffId, check_type: 'check_out' })
                });
                
                if (response.ok) {
                    showToast('Check-out recorded successfully!', 'success');
                    loadStaffOnDuty();
                }
            } catch (error) {
                showToast('Failed to record check-out', 'error');
            }
        }
        
        // Modal open functions with event stopping
        function openNewPatientModal(e) {
            e.stopPropagation();
            openModal('newPatientModal');
        }
        
        function openPatientsListModal(e) {
            e.stopPropagation();
            showToast('Loading patients list...', 'success');
        }
        
        function openInvoiceModal(e) {
            e.stopPropagation();
            openModal('invoiceModal');
        }
        
        function openInvoicesListModal(e) {
            e.stopPropagation();
            showToast('Loading invoices...', 'success');
        }
        
        function openStockEntryModal(e) {
            e.stopPropagation();
            loadInventoryItems();
            openModal('stockEntryModal');
        }
        
        function openLowStockModal(e) {
            e.stopPropagation();
            showLowStockItems();
        }
        
        function openScheduleModal(e) {
            e.stopPropagation();
            loadStaffList();
            openModal('scheduleModal');
        }
        
        function openRosterModal(e) {
            e.stopPropagation();
            showToast('Loading roster...', 'success');
        }
        
        function openAdmissionModal(e) {
            e.stopPropagation();
            loadWards();
            openModal('admissionModal');
        }
        
        function openBedsModal(e) {
            e.stopPropagation();
            showAvailableBeds();
        }
        
        function openAnalyticsModal(e) {
            e.stopPropagation();
            loadAnalytics();
            openModal('analyticsModal');
        }
        
        function openReportModal(e) {
            e.stopPropagation();
            showToast('Opening report export...', 'success');
        }
        
        // Load inventory items for dropdown
        async function loadInventoryItems() {
            try {
                const response = await fetch(`${API_BASE}/api/inventory/items`);
                const items = await response.json();
                
                const select = document.querySelector('#stockEntryModal select[name="item_id"]');
                select.innerHTML = '<option value="">Select Item</option>' +
                    items.map(item => `<option value="${item.item_id}">${item.name} (Current: ${item.current_quantity})</option>`).join('');
            } catch (error) {
                console.error('Error loading inventory items:', error);
            }
        }
        
        // Load staff list for scheduling
        async function loadStaffList() {
            try {
                const response = await fetch(`${API_BASE}/api/staff/all`);
                const staff = await response.json();
                
                const select = document.querySelector('#scheduleModal select[name="staff_id"]');
                select.innerHTML = '<option value="">Select Staff</option>' +
                    staff.map(s => `<option value="${s.staff_id}">${s.name} - ${s.position}</option>`).join('');
            } catch (error) {
                console.error('Error loading staff list:', error);
            }
        }
        
        // Load wards for admission
        async function loadWards() {
            try {
                // For now, use static ward data
                const wards = [
                    { ward_id: 1, name: 'General Ward A' },
                    { ward_id: 2, name: 'ICU' },
                    { ward_id: 3, name: 'Maternity Ward' },
                    { ward_id: 4, name: 'Pediatric Ward' },
                    { ward_id: 5, name: 'Emergency Ward' }
                ];
                
                const select = document.querySelector('#admissionModal select[name="ward_id"]');
                select.innerHTML = '<option value="">Select Ward</option>' +
                    wards.map(w => `<option value="${w.ward_id}">${w.name}</option>`).join('');
            } catch (error) {
                console.error('Error loading wards:', error);
            }
        }
        
        // Load available beds for a ward
        async function loadAvailableBeds(wardId) {
            if (!wardId) {
                document.querySelector('#admissionModal select[name="bed_id"]').innerHTML = '<option value="">Select Ward First</option>';
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/beds/available`);
                const beds = await response.json();
                
                const wardBeds = beds.filter(bed => bed.ward_id == wardId);
                const select = document.querySelector('#admissionModal select[name="bed_id"]');
                
                if (wardBeds.length === 0) {
                    select.innerHTML = '<option value="">No beds available</option>';
                } else {
                    select.innerHTML = '<option value="">Select Bed</option>' +
                        wardBeds.map(bed => `<option value="${bed.bed_id}">${bed.bed_number}</option>`).join('');
                }
            } catch (error) {
                console.error('Error loading beds:', error);
            }
        }
        
        // Show low stock items
        async function showLowStockItems() {
            try {
                const response = await fetch(`${API_BASE}/api/inventory/low-stock`);
                const items = await response.json();
                
                let content = '<h3>Low Stock Items</h3><ul>';
                items.forEach(item => {
                    content += `<li>${item.name}: ${item.current_quantity} units (Reorder at: ${item.reorder_level})</li>`;
                });
                content += '</ul>';
                
                showToast(`Found ${items.length} low stock items`, 'success');
            } catch (error) {
                showToast('Failed to load low stock items', 'error');
            }
        }
        
        // Show available beds
        async function showAvailableBeds() {
            try {
                const response = await fetch(`${API_BASE}/api/beds/available`);
                const beds = await response.json();
                
                showToast(`${beds.length} beds available`, 'success');
            } catch (error) {
                showToast('Failed to load available beds', 'error');
            }
        }
        
        // Load analytics
        async function loadAnalytics() {
            try {
                const response = await fetch(`${API_BASE}/api/analytics/dashboard`);
                const data = await response.json();
                
                document.getElementById('todayAdmissions').textContent = data.todayStats.admissions_today || '0';
                document.getElementById('emergencyVisits').textContent = data.todayStats.emergency_visits || '0';
                document.getElementById('weekRevenue').textContent = `GH₵ ${formatNumber(data.revenue.week_revenue || 0)}`;
                document.getElementById('monthRevenue').textContent = `GH₵ ${formatNumber(data.revenue.month_revenue || 0)}`;
            } catch (error) {
                console.error('Error loading analytics:', error);
            }
        }
        
        // Add invoice item
        function addInvoiceItem() {
            const container = document.getElementById('invoiceItems');
            const item = document.createElement('div');
            item.className = 'invoice-item';
            item.innerHTML = `
                <input type="text" placeholder="Description" name="item_description[]" required>
                <input type="number" placeholder="Qty" name="item_quantity[]" min="1" required style="width: 80px;">
                <input type="number" placeholder="Price" name="item_price[]" min="0" step="0.01" required style="width: 100px;">
            `;
            container.appendChild(item);
        }
        
        // Switch tabs
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
        
        // Utility functions
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString();
        }
        
        function formatNumber(num) {
            return new Intl.NumberFormat().format(num || 0);
        }
        
        function getStatusClass(status) {
            switch(status) {
                case 'Present': return 'status-active';
                case 'Absent': return 'status-occupied';
                case 'On Duty': return 'status-active';
                default: return 'status-pending';
            }
        }
        
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toast.className = `toast ${type} show`;
            toastMessage.textContent = message;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
